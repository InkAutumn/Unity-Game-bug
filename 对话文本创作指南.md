# 对话文本创作指南

### 对话系统架构

```
对话数据文件 (ScriptableObject)
    └── 对话节点列表 (DialogueNode)
        ├── 节点ID
        ├── 角色名称
        ├── 对话文本
        ├── 手部图片
        ├── 背景图片
        ├── 选项列表 (可选)
        ├── 下一节点ID (可选)
        └── 触发小游戏 (可选)
```

**节点（Node）**
- 一段完整的对话内容
- 每个节点有唯一ID

**分支（Branch）**
- 玩家选择导致不同走向
- 通过选项实现

**标记（Flag）**
- 记录剧情进度
- 根据标记显示不同内容

---

## 对话节点结构

### 标准节点模板

```
节点ID: 0
角色名: 奶奶
对话文本: "今天我们一起包饺子吧！"
手部图片: grandma_hands
背景图片: kitchen
下一节点: 1
```

#### 节点ID (nodeId)
```
格式: 整数
范围: 0~9999
规则:
- 每个节点ID必须唯一
- 建议按顺序递增 (0, 1, 2, 3...)
- 分支剧情可用不同区段 (主线0-99, 分支100-199)

示例:
节点ID: 0     ✓ 正确
节点ID: 1     ✓ 正确
节点ID: 100   ✓ 正确（分支起点）
节点ID: 1.5   ✗ 错误（不能是小数）
节点ID: A1    ✗ 错误（不能包含字母）
```

#### 角色名 (characterName)
```
格式: 文本字符串
长度: 1-10个汉字
规则:
- 显示在对话框上方
- 可以为空（旁白/系统提示）
- 不同角色统一使用固定名称

示例:
角色名: 奶奶        ✓ 正确
角色名: 小明        ✓ 正确
角色名: 妈妈        ✓ 正确
角色名: （留空）    ✓ 正确（旁白）
```

#### 对话文本 (dialogueText)
```
格式: 文本字符串
长度: 建议1-150汉字
规则:
- 支持换行（用\n表示）
- 自动显示打字机效果
- 避免过长（超过150字考虑拆分）

示例:
对话文本: "今天天气真好啊！"                    ✓ 正确
对话文本: "我们一起包饺子吧。\n你想学吗？"      ✓ 正确（换行）
```

#### 手部图片 (handsSprite)
```
格式: 文件名（不含路径和扩展名）
规则:
- 对应Resources/Hands/文件夹下的图片
- 不写扩展名.png
- 区分大小写

示例:
手部图片: grandma_hands           ✓ 正确
手部图片: grandma_hands_water     ✓ 正确
手部图片: child_hands             ✓ 正确
手部图片: Grandma_Hands           ✗ 大小写错误
手部图片: grandma_hands.png       ✗ 不要加扩展名
```

#### 背景图片 (backgroundImage)
```
格式: 文件名（不含路径和扩展名）
规则:
- 对应Resources/Backgrounds/文件夹下的图片
- 不写扩展名
- 区分大小写

示例:
背景图片: kitchen          ✓ 正确
背景图片: dining_room      ✓ 正确
背景图片: Kitchen          ✗ 大小写错误
背景图片: kitchen.jpg      ✗ 不要加扩展名
```

## 文本格式要求

### 3对话文本规范

#### 长度建议
```
单句对话: 20-60汉字最佳
长对话: 60-150汉字
超长文本: 拆分为多个节点

原因:
- 对话框显示区域有限
- 打字机效果太长会等待太久
- 移动端屏幕更小
```

#### 标点符号
```
✗ 避免使用:
- 英文标点 ,.?!
- 书名号 《》（除非必要）
- 括号 () （尽量少用）
- 顿号 、（用逗号代替）
- 引号 "" 可以用，但会影响JSON导出
- 如果必须用引号，使用中文引号""
```

#### 换行规则
```
自然段落: 用\n换行
每段: 建议不超过2行（对话框显示）

示例:
"今天天气真好。\n我们去包饺子吧。"

显示效果:
┌─────────────────────┐
│ 今天天气真好。      │
│ 我们去包饺子吧。    │
└─────────────────────┘
```

### 角色名称规范

#### 统一性
```
同一角色在所有对话中使用相同名称
```

#### 特殊情况
```
旁白/系统提示: 角色名留空
内心独白: 可用"（心声）"或留空

示例:
角色名: （留空）
对话文本: "窗外飘来阵阵香味。"
```

---

## 选项分支编写

### 选项格式

#### 基本结构
```
选项文本: "想学包饺子"
目标节点: 10

选项文本: "不想学"
目标节点: 20
```

#### 简单分支
```
节点5:
  对话: "你想学吗？"
  选项1: "想学" → 节点10
  选项2: "不想" → 节点20

节点10:
  对话: "那我们开始吧！"

节点20:
  对话: "那就先看看吧。"
```

#### 多路分支
```
节点8:
  对话: "选择一种馅料吧。"
  选项1: "猪肉大葱" → 节点30
  选项2: "韭菜鸡蛋" → 节点31
  选项3: "香菇青菜" → 节点32
```

#### 条件分支（需要剧情标记）
```
节点15:
  对话: "你之前包过饺子吗？"
  选项1: "包过" → 节点40
      要求标记: hasExperience = true
  选项2: "没包过" → 节点41
      要求标记: （无）
```

## 剧情标记系统

### 标记概念

剧情标记（Story Flag）用于：
- 记录玩家选择
- 记录游戏进度
- 控制条件分支
- 记录游戏成就

### 标记命名规范

```
长度: 建议10-30个字符
语言: 英文

✓ 推荐命名:
metGrandma           - 遇见奶奶
learnedDumpling      - 学会包饺子
chosePorkFilling     - 选择猪肉馅
dumplingExcellent    - 饺子做得优秀
finishedChapter1     - 完成第一章
✗ 不推荐:
met_grandma          - 避免下划线
MET_GRANDMA          - 避免全大写
遇见奶奶             - 避免中文
metgrandma           - 避免全小写（难读）
```

### 标记使用示例

#### 设置标记（在文案中标注）
```
节点15:
  对话: "太好了，你学会了！"
  [设置标记: learnedDumpling = true]
  下一节点: 16
```

#### 检查标记（条件选项）
```
节点20:
  对话: "你还记得怎么做吗？"
  选项1: "记得" → 节点30
      [要求标记: learnedDumpling = true]
  选项2: "忘了" → 节点31
```

## 特殊功能

### 触发小游戏

#### 标注方法
```
节点10:
  角色名: 奶奶
  对话文本: "来，我们开始包饺子吧！"
  手部图片: grandma_hands
  背景图片: kitchen
  [触发小游戏]
  游戏模式: 目标数量
  目标数量: 5
  下一节点: 11
```

#### 游戏模式说明

**目标数量模式**
```
游戏模式: 目标数量
目标数量: 5
时间限制: 0（无限时）

描述: 玩家必须完成5个饺子才能继续
用途: 教学、剧情关键节点
```

**计时模式**
```
游戏模式: 计时
目标数量: 0（不限数量）
时间限制: 60（秒）

描述: 60秒内尽可能多包饺子
用途: 挑战、竞赛剧情
```

### 小游戏后的分支

小游戏结束后会自动设置标记，根据表现分支：

```
节点11（游戏结束后）:
  [自动检查标记]

  如果 dumplingExcellent = true:
    跳转到 节点100（优秀对话）

  如果 dumplingGood = true:
    跳转到 节点101（良好对话）

  如果 dumplingAverage = true:
    跳转到 节点102（普通对话）

  如果 dumplingPoor = true:
    跳转到 节点103（需要改进对话）
```

#### 编写示例
```
节点100:
  角色名: 奶奶
  对话文本: "太棒了！你包得比我还好！"
  手部图片: grandma_hands
  背景图片: kitchen
  下一节点: 110

节点101:
  角色名: 奶奶
  对话文本: "很不错，有天赋！"
  手部图片: grandma_hands
  背景图片: kitchen
  下一节点: 110

节点102:
  角色名: 奶奶
  对话文本: "还不错，多练练就好了。"
  手部图片: grandma_hands
  背景图片: kitchen
  下一节点: 110

节点103:
  角色名: 奶奶
  对话文本: "没关系，我们慢慢来。"
  手部图片: grandma_hands
  背景图片: kitchen
  下一节点: 110
```

---

## 交付格式

### 推荐格式：Excel表格

#### 表格结构

| 节点ID | 角色名 | 对话文本 | 手部图片 | 背景图片 | 选项1文本 | 选项1目标 | 选项2文本 | 选项2目标 | 下一节点 | 触发游戏 | 备注 |
|--------|--------|----------|----------|----------|-----------|-----------|-----------|-----------|----------|----------|------|
| 0 | 奶奶 | 今天我们一起包饺子吧！ | grandma_hands | kitchen | | | | | 1 | | 开场 |
| 1 | 奶奶 | 你想学吗？ | grandma_hands | kitchen | 想学 | 10 | 不想 | 20 | | | 分支 |
| 10 | 奶奶 | 那我们开始吧！ | grandma_hands | kitchen | | | | | 11 | 目标5个 | 小游戏 |
